import pandas
import numpy

table = pandas.read_csv('vulnerabilities_mapping.csv')
newTable = pandas.DataFrame(columns=['Tool', 'RuleId', 'Vulnerability', 'Type'])

type_counter = {}

for row in table.values:

    # skip last empty lines -- why do they exist?
    if pandas.isna(row[0]):
        continue

    tool = row[0]
    vulnerability = row[1]
    type = "Unknown"
    for i in range(2, 13):
        if not pandas.isna(row[i]):
            type = table.columns[i].replace("_", " ").title().replace(" ", "")

    if type in type_counter.keys():
        type_counter[type] += 1
    else:
        type_counter[type] = 1

    ruleId = type + "_" + str(type_counter[type])

    newRow = pandas.DataFrame([[tool, ruleId, vulnerability, type]],
                              columns=['Tool', 'RuleId', 'Vulnerability', 'Type'])

    newTable = newTable.append(newRow)

newTable.to_csv('sarif_vulnerability_mapping.csv', index=False)
